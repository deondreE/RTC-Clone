#include <stdint.h>
#include <stdbool.h>

// Simple 8x8 bitmap font
// Each character is 8 bytes, each byte represents a row of 8 pixels
static const uint8_t font_data[128][8] = {
    // 0x00-0x1F: Control characters (blank)
    [0 ... 31] = {0},
    
    // 0x20: Space
    [32] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // 0x21: !
    [33] = {0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x00},
    
    // 0x22: "
    [34] = {0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // 0x23: #
    [35] = {0x36, 0x36, 0x7F, 0x36, 0x7F, 0x36, 0x36, 0x00},
    
    // 0x24: $
    [36] = {0x0C, 0x3F, 0x68, 0x3E, 0x0B, 0x7E, 0x18, 0x00},
    
    // 0x25: %
    [37] = {0x60, 0x66, 0x0C, 0x18, 0x30, 0x66, 0x06, 0x00},
    
    // 0x26: &
    [38] = {0x38, 0x6C, 0x6C, 0x38, 0x6D, 0x66, 0x3B, 0x00},
    
    // 0x27: '
    [39] = {0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // 0x28: (
    [40] = {0x0C, 0x18, 0x30, 0x30, 0x30, 0x18, 0x0C, 0x00},
    
    // 0x29: )
    [41] = {0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x18, 0x30, 0x00},
    
    // 0x2A: *
    [42] = {0x00, 0x18, 0x7E, 0x3C, 0x7E, 0x18, 0x00, 0x00},
    
    // 0x2B: +
    [43] = {0x00, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x00, 0x00},
    
    // 0x2C: ,
    [44] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30},
    
    // 0x2D: -
    [45] = {0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00},
    
    // 0x2E: .
    [46] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00},
    
    // 0x2F: /
    [47] = {0x00, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x00, 0x00},
    
    // 0x30-0x39: Numbers 0-9
    [48] = {0x3C, 0x66, 0x6E, 0x7E, 0x76, 0x66, 0x3C, 0x00}, // 0
    [49] = {0x18, 0x38, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00}, // 1
    [50] = {0x3C, 0x66, 0x06, 0x0C, 0x18, 0x30, 0x7E, 0x00}, // 2
    [51] = {0x3C, 0x66, 0x06, 0x1C, 0x06, 0x66, 0x3C, 0x00}, // 3
    [52] = {0x0C, 0x1C, 0x3C, 0x6C, 0x7E, 0x0C, 0x0C, 0x00}, // 4
    [53] = {0x7E, 0x60, 0x7C, 0x06, 0x06, 0x66, 0x3C, 0x00}, // 5
    [54] = {0x1C, 0x30, 0x60, 0x7C, 0x66, 0x66, 0x3C, 0x00}, // 6
    [55] = {0x7E, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00}, // 7
    [56] = {0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x3C, 0x00}, // 8
    [57] = {0x3C, 0x66, 0x66, 0x3E, 0x06, 0x0C, 0x38, 0x00}, // 9
    
    // 0x3A: :
    [58] = {0x00, 0x00, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00},
    
    // 0x3B: ;
    [59] = {0x00, 0x00, 0x18, 0x18, 0x00, 0x18, 0x18, 0x30},
    
    // 0x3C: <
    [60] = {0x0C, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0C, 0x00},
    
    // 0x3D: =
    [61] = {0x00, 0x00, 0x7E, 0x00, 0x7E, 0x00, 0x00, 0x00},
    
    // 0x3E: >
    [62] = {0x30, 0x18, 0x0C, 0x06, 0x0C, 0x18, 0x30, 0x00},
    
    // 0x3F: ?
    [63] = {0x3C, 0x66, 0x0C, 0x18, 0x18, 0x00, 0x18, 0x00},
    
    // 0x40: @
    [64] = {0x3C, 0x66, 0x6E, 0x6A, 0x6E, 0x60, 0x3C, 0x00},
    
    // 0x41-0x5A: Uppercase A-Z
    [65] = {0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00}, // A
    [66] = {0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00}, // B
    [67] = {0x3C, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00}, // C
    [68] = {0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00}, // D
    [69] = {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x7E, 0x00}, // E
    [70] = {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x00}, // F
    [71] = {0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3C, 0x00}, // G
    [72] = {0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00}, // H
    [73] = {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00}, // I
    [74] = {0x3E, 0x0C, 0x0C, 0x0C, 0x0C, 0x6C, 0x38, 0x00}, // J
    [75] = {0x66, 0x6C, 0x78, 0x70, 0x78, 0x6C, 0x66, 0x00}, // K
    [76] = {0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00}, // L
    [77] = {0x63, 0x77, 0x7F, 0x6B, 0x6B, 0x63, 0x63, 0x00}, // M
    [78] = {0x66, 0x66, 0x76, 0x7E, 0x6E, 0x66, 0x66, 0x00}, // N
    [79] = {0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00}, // O
    [80] = {0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00}, // P
    [81] = {0x3C, 0x66, 0x66, 0x66, 0x6A, 0x6C, 0x36, 0x00}, // Q
    [82] = {0x7C, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0x66, 0x00}, // R
    [83] = {0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00}, // S
    [84] = {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00}, // T
    [85] = {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00}, // U
    [86] = {0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00}, // V
    [87] = {0x63, 0x63, 0x6B, 0x6B, 0x7F, 0x77, 0x63, 0x00}, // W
    [88] = {0x66, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x66, 0x00}, // X
    [89] = {0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00}, // Y
    [90] = {0x7E, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x7E, 0x00}, // Z
    
    // 0x5B: [
    [91] = {0x3C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3C, 0x00},
    
    // 0x5C: backslash
    [92] = {0x00, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x00, 0x00},
    
    // 0x5D: ]
    [93] = {0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3C, 0x00},
    
    // 0x5E: ^
    [94] = {0x18, 0x3C, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // 0x5F: _
    [95] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF},
    
    // 0x60: `
    [96] = {0x30, 0x18, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00},
    
    // 0x61-0x7A: Lowercase a-z
    [97] = {0x00, 0x00, 0x3C, 0x06, 0x3E, 0x66, 0x3E, 0x00},  // a
    [98] = {0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x00},  // b
    [99] = {0x00, 0x00, 0x3C, 0x66, 0x60, 0x66, 0x3C, 0x00},  // c
    [100] = {0x06, 0x06, 0x3E, 0x66, 0x66, 0x66, 0x3E, 0x00}, // d
    [101] = {0x00, 0x00, 0x3C, 0x66, 0x7E, 0x60, 0x3C, 0x00}, // e
    [102] = {0x1C, 0x30, 0x30, 0x7C, 0x30, 0x30, 0x30, 0x00}, // f
    [103] = {0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x3C}, // g
    [104] = {0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00}, // h
    [105] = {0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x3C, 0x00}, // i
    [106] = {0x0C, 0x00, 0x1C, 0x0C, 0x0C, 0x0C, 0x6C, 0x38}, // j
    [107] = {0x60, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0x00}, // k
    [108] = {0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00}, // l
    [109] = {0x00, 0x00, 0x66, 0x7F, 0x7F, 0x6B, 0x6B, 0x00}, // m
    [110] = {0x00, 0x00, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00}, // n
    [111] = {0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x00}, // o
    [112] = {0x00, 0x00, 0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60}, // p
    [113] = {0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x06}, // q
    [114] = {0x00, 0x00, 0x6C, 0x76, 0x60, 0x60, 0x60, 0x00}, // r
    [115] = {0x00, 0x00, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x00}, // s
    [116] = {0x30, 0x30, 0x7C, 0x30, 0x30, 0x30, 0x1C, 0x00}, // t
    [117] = {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x00}, // u
    [118] = {0x00, 0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00}, // v
    [119] = {0x00, 0x00, 0x63, 0x6B, 0x6B, 0x7F, 0x36, 0x00}, // w
    [120] = {0x00, 0x00, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x00}, // x
    [121] = {0x00, 0x00, 0x66, 0x66, 0x66, 0x3E, 0x06, 0x3C}, // y
    [122] = {0x00, 0x00, 0x7E, 0x0C, 0x18, 0x30, 0x7E, 0x00}, // z
    
    // 0x7B: {
    [123] = {0x0E, 0x18, 0x18, 0x70, 0x18, 0x18, 0x0E, 0x00},
    
    // 0x7C: |
    [124] = {0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x00},
    
    // 0x7D: }
    [125] = {0x70, 0x18, 0x18, 0x0E, 0x18, 0x18, 0x70, 0x00},
    
    // 0x7E: ~
    [126] = {0x00, 0x00, 0x76, 0xDC, 0x00, 0x00, 0x00, 0x00},
    
    // 0x7F: DEL (blank)
    [127] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
};

void draw_char_bitmap(uint8_t* framebuffer, int x, int y, char c, 
                      uint32_t color, int screen_width) {
    if (c < 0 || c > 127) c = '?';
    
    const uint8_t* glyph = font_data[(int)c];
    
    for (int row = 0; row < 8; row++) {
        uint8_t row_data = glyph[row];
        for (int col = 0; col < 8; col++) {
            if (row_data & (0x80 >> col)) {
                int px = x + col;
                int py = y + row;
                
                if (px >= 0 && px < screen_width && py >= 0 && py < 600) {
                    int idx = (py * screen_width + px) * 4;
                    framebuffer[idx + 0] = (color >> 0) & 0xFF;  // B
                    framebuffer[idx + 1] = (color >> 8) & 0xFF;  // G
                    framebuffer[idx + 2] = (color >> 16) & 0xFF; // R
                    framebuffer[idx + 3] = 0xFF;                 // A
                }
            }
        }
    }
}

void draw_text_bitmap(uint8_t* framebuffer, int x, int y, const char* text, 
                      uint32_t color, int screen_width) {
    int offset = 0;
    while (*text) {
        draw_char_bitmap(framebuffer, x + offset, y, *text, color, screen_width);
        offset += 8;  // 8 pixels per character
        text++;
    }
}